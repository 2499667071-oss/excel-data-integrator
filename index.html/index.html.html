<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Excelæ•°æ®æ•´åˆå¹³å° - æ‰‹æœºç”µè„‘éƒ½èƒ½ç”¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“Š</text></svg>">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f94144;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.15);
            --radius: 12px;
            --transition: all 0.3s ease;
        }
        
        /* åŸºç¡€é‡ç½® */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }
        
        /* å®¹å™¨ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }
        
        /* å¤´éƒ¨ */
        .header {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 8px;
        }
        
        .logo-icon {
            font-size: 2.2rem;
            color: var(--primary);
        }
        
        .logo-text h1 {
            font-size: 1.5rem;
            color: var(--dark);
            margin-bottom: 4px;
        }
        
        .logo-text p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .logo-text h1 {
                font-size: 1.3rem;
            }
            
            .container {
                padding: 12px;
            }
        }
        
        /* ä¸»å†…å®¹ */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* å¡ç‰‡ */
        .card {
            background: white;
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }
        
        .card-header {
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--light-gray);
        }
        
        .card-header h2 {
            font-size: 1.4rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-area {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .upload-box {
            border: 3px dashed var(--light-gray);
            border-radius: var(--radius);
            padding: 30px 20px;
            text-align: center;
            transition: var(--transition);
            background: var(--light);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 250px;
        }
        
        .upload-box:hover, .upload-box.dragover {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
            transform: translateY(-3px);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 16px;
        }
        
        .upload-box h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: var(--dark);
        }
        
        .upload-box p {
            color: var(--gray);
            margin-bottom: 20px;
            font-size: 0.9rem;
        }
        
        /* æŒ‰é’® */
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            margin-bottom: 10px;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .btn-primary:hover {
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #3a86ff);
            color: white;
        }
        
        .btn-secondary {
            background: var(--gray);
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* æ–‡ä»¶ä¿¡æ¯ */
        .file-info {
            margin-top: 16px;
            padding: 16px;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--light-gray);
            text-align: left;
            width: 100%;
        }
        
        .file-name {
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 6px;
            word-break: break-all;
        }
        
        .file-meta {
            display: flex;
            justify-content: space-between;
            color: var(--gray);
            font-size: 0.85rem;
        }
        
        /* è¡¨æ ¼ */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid var(--light-gray);
            background: white;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        th {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            left: 0;
            white-space: nowrap;
        }
        
        td {
            padding: 14px 12px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #e8f4fc;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            border-top: 4px solid var(--primary);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--dark);
            margin: 12px 0;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* æ ‡ç­¾é¡µ */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--light-gray);
            margin-bottom: 20px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab {
            padding: 14px 20px;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .tab.active {
            color: var(--primary);
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* æ¶ˆæ¯æç¤º */
        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loader {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ç§»åŠ¨ç«¯ç‰¹å®šä¼˜åŒ– */
        .mobile-only {
            display: none;
        }
        
        @media (max-width: 768px) {
            .mobile-only {
                display: block;
            }
            
            .desktop-only {
                display: none;
            }
            
            .upload-area {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .card {
                padding: 16px;
            }
            
            .btn {
                padding: 16px 20px;
                font-size: 1.1rem;
            }
            
            th, td {
                padding: 12px 8px;
                font-size: 0.9rem;
            }
            
            /* ç§»åŠ¨ç«¯åº•éƒ¨æ“ä½œæ  */
            .mobile-actions {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                padding: 12px 16px;
                box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
                display: flex;
                gap: 10px;
                z-index: 1000;
            }
            
            .mobile-actions .btn {
                flex: 1;
                margin: 0;
                padding: 14px;
            }
            
            .container {
                padding-bottom: 80px; /* ä¸ºåº•éƒ¨æ“ä½œæ ç•™å‡ºç©ºé—´ */
            }
        }
        
        /* è‹¹æœSafariä¼˜åŒ– */
        @supports (-webkit-touch-callout: none) {
            .container {
                padding-bottom: calc(80px + env(safe-area-inset-bottom));
            }
            
            .mobile-actions {
                padding-bottom: calc(12px + env(safe-area-inset-bottom));
            }
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #dee2e6;
        }
        
        /* é¡µè„š */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--light-gray);
            color: var(--gray);
            font-size: 0.85rem;
        }
        
        /* å®‰è£…æç¤ºï¼ˆPWAï¼‰ */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: white;
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            display: none;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .install-prompt p {
            margin-bottom: 12px;
        }
        
        .install-prompt-buttons {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">ğŸ“Š</div>
                <div class="logo-text">
                    <h1>Excelæ•°æ®æ•´åˆ</h1>
                    <p>æ‰‹æœºç”µè„‘éƒ½èƒ½ç”¨ Â· æ— é™åˆ¶ä½¿ç”¨</p>
                </div>
            </div>
            <div class="mobile-only" style="margin-top: 12px; font-size: 0.85rem; color: var(--primary);">
                <i class="fas fa-mobile-alt"></i> å·²ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ
            </div>
        </header>

        <!-- ä¸»å†…å®¹ -->
        <main class="main-content">
            <!-- ä¸Šä¼ æ–‡ä»¶å¡ç‰‡ -->
            <div class="card" id="upload-card">
                <div class="card-header">
                    <h2><i class="fas fa-cloud-upload-alt"></i> ä¸Šä¼ Excelæ–‡ä»¶</h2>
                    <p style="color: var(--gray); font-size: 0.95rem; margin-top: 8px;">
                        ä¸Šä¼ ä¸¤ä¸ªExcelæ–‡ä»¶ï¼Œç³»ç»Ÿè‡ªåŠ¨æ ¹æ®ç”¨æˆ·ååŒ¹é…åºå·
                    </p>
                </div>
                
                <div class="upload-area">
                    <div class="upload-box" id="upload-box-1" onclick="document.getElementById('file1').click()">
                        <div class="upload-icon">
                            <i class="fas fa-file-excel"></i>
                        </div>
                        <h3>æ–‡ä»¶1ï¼šç”¨æˆ·åˆ—è¡¨</h3>
                        <p>åŒ…å«"åºå·"å’Œ"ç”¨æˆ·å"åˆ—çš„Excelæ–‡ä»¶</p>
                        <div class="file-info" id="file1-info">
                            <div class="file-name">ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½æ–‡ä»¶</div>
                            <div class="file-meta">
                                <span>æ”¯æŒ: .xlsx, .xls, .csv</span>
                                <span>å¤§å°: æ— é™åˆ¶</span>
                            </div>
                        </div>
                        <input type="file" id="file1" accept=".xlsx,.xls,.csv" style="display:none;">
                    </div>
                    
                    <div class="upload-box" id="upload-box-2" onclick="document.getElementById('file2').click()">
                        <div class="upload-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <h3>æ–‡ä»¶2ï¼šè®¢å•æ•°æ®</h3>
                        <p>åŒ…å«"ç”¨æˆ·å"åˆ—çš„Excelæ–‡ä»¶</p>
                        <div class="file-info" id="file2-info">
                            <div class="file-name">ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½æ–‡ä»¶</div>
                            <div class="file-meta">
                                <span>æ”¯æŒ: .xlsx, .xls, .csv</span>
                                <span>å¤§å°: æ— é™åˆ¶</span>
                            </div>
                        </div>
                        <input type="file" id="file2" accept=".xlsx,.xls,.csv" style="display:none;">
                    </div>
                </div>
                
                <div class="alert alert-info" id="upload-help" style="display: none;">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>æç¤ºï¼š</strong> ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«"ç”¨æˆ·å"åˆ—è¿›è¡ŒåŒ¹é…ã€‚ç¡®ä¿ä¸¤ä¸ªæ–‡ä»¶éƒ½æœ‰ç”¨æˆ·ååˆ—ã€‚
                    </div>
                </div>
                
                <div class="loader" id="upload-loader">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨è¯»å–æ–‡ä»¶...</p>
                </div>
                
                <div id="upload-buttons" style="display: none;">
                    <button class="btn btn-primary" onclick="previewData()">
                        <i class="fas fa-eye"></i> é¢„è§ˆæ•°æ®
                    </button>
                </div>
            </div>
            
            <!-- æ•°æ®é¢„è§ˆå¡ç‰‡ -->
            <div class="card" id="preview-card" style="display: none;">
                <div class="card-header">
                    <h2><i class="fas fa-table"></i> æ•°æ®é¢„è§ˆ</h2>
                </div>
                
                <div class="tabs">
                    <button class="tab active" data-tab="preview-tab-1">æ–‡ä»¶1é¢„è§ˆ</button>
                    <button class="tab" data-tab="preview-tab-2">æ–‡ä»¶2é¢„è§ˆ</button>
                </div>
                
                <div id="preview-tab-1" class="tab-content active">
                    <div class="table-container">
                        <table id="preview-table-1">
                            <!-- æ–‡ä»¶1é¢„è§ˆæ•°æ® -->
                        </table>
                    </div>
                </div>
                
                <div id="preview-tab-2" class="tab-content">
                    <div class="table-container">
                        <table id="preview-table-2">
                            <!-- æ–‡ä»¶2é¢„è§ˆæ•°æ® -->
                        </table>
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="processIntegration()" style="margin-top: 20px;">
                    <i class="fas fa-cogs"></i> å¼€å§‹æ•°æ®æ•´åˆ
                </button>
            </div>
            
            <!-- æ•´åˆç»“æœå¡ç‰‡ -->
            <div class="card" id="result-card" style="display: none;">
                <div class="card-header">
                    <h2><i class="fas fa-check-circle"></i> æ•´åˆç»“æœ</h2>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">æ€»è®°å½•</div>
                        <div class="stat-value" id="stat-total">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">åŒ¹é…æˆåŠŸ</div>
                        <div class="stat-value" id="stat-matched">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">åŒ¹é…ç‡</div>
                        <div class="stat-value" id="stat-rate">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">å¤„ç†æ—¶é—´</div>
                        <div class="stat-value" id="stat-time">0s</div>
                    </div>
                </div>
                
                <div class="tabs">
                    <button class="tab active" data-tab="result-tab">æ•´åˆç»“æœ</button>
                    <button class="tab" data-tab="unmatched-tab">æœªåŒ¹é…æ•°æ®</button>
                </div>
                
                <div id="result-tab" class="tab-content active">
                    <div class="table-container">
                        <table id="result-table">
                            <!-- æ•´åˆç»“æœæ•°æ® -->
                        </table>
                    </div>
                </div>
                
                <div id="unmatched-tab" class="tab-content">
                    <div class="table-container">
                        <table id="unmatched-table">
                            <!-- æœªåŒ¹é…æ•°æ® -->
                        </table>
                    </div>
                </div>
                
                <div style="display: flex; gap: 12px; margin-top: 20px; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="downloadResult()" style="flex: 1;">
                        <i class="fas fa-download"></i> ä¸‹è½½Excel
                    </button>
                    <button class="btn btn-primary" onclick="resetApp()" style="flex: 1;">
                        <i class="fas fa-redo"></i> é‡æ–°å¼€å§‹
                    </button>
                </div>
            </div>
        </main>
        
        <!-- ç§»åŠ¨ç«¯åº•éƒ¨æ“ä½œæ  -->
        <div class="mobile-actions" id="mobile-actions" style="display: none;">
            <button class="btn btn-primary" onclick="processIntegration()" id="mobile-process-btn">
                <i class="fas fa-cogs"></i> å¼€å§‹æ•´åˆ
            </button>
            <button class="btn btn-success" onclick="downloadResult()" id="mobile-download-btn" disabled>
                <i class="fas fa-download"></i> ä¸‹è½½
            </button>
        </div>
        
        <!-- PWAå®‰è£…æç¤º -->
        <div class="install-prompt" id="install-prompt">
            <p><strong>æ·»åŠ åˆ°ä¸»å±å¹•</strong> ä»¥ä¾¿ç¦»çº¿ä½¿ç”¨æ­¤å·¥å…·</p>
            <div class="install-prompt-buttons">
                <button class="btn btn-secondary" onclick="hideInstallPrompt()" style="flex: 1;">
                    ç¨åå†è¯´
                </button>
                <button class="btn btn-primary" onclick="installApp()" style="flex: 1;">
                    ç«‹å³å®‰è£…
                </button>
            </div>
        </div>
        
        <!-- é¡µè„š -->
        <footer class="footer">
            <p>Excelæ•°æ®æ•´åˆå¹³å° &copy; 2023 | å®Œå…¨å…è´¹ Â· æ— é™åˆ¶ä½¿ç”¨</p>
            <p style="margin-top: 8px; font-size: 0.8rem;">
                æ”¯æŒ iOS Safari, Android Chrome, å¾®ä¿¡æµè§ˆå™¨, ç”µè„‘æµè§ˆå™¨
            </p>
        </footer>
    </div>

    <!-- JavaScript -->
    <script>
        // å…¨å±€å˜é‡
        let file1Data = null;
        let file2Data = null;
        let integrationResult = null;
        let startTime = null;
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });
        
        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            // åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ 
            initFileUpload();
            
            // åˆå§‹åŒ–æ ‡ç­¾é¡µ
            initTabs();
            
            // åˆå§‹åŒ–æ‹–æ‹½ä¸Šä¼ 
            initDragAndDrop();
            
            // æ£€æŸ¥PWAå®‰è£…
            checkPWAInstall();
            
            // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
            setTimeout(() => {
                showAlert('æ¬¢è¿ä½¿ç”¨Excelæ•°æ®æ•´åˆå·¥å…·ï¼æ”¯æŒæ‰‹æœºå’Œç”µè„‘ã€‚', 'info', 5000);
            }, 1000);
        }
        
        // åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ 
        function initFileUpload() {
            // æ–‡ä»¶1ä¸Šä¼ 
            document.getElementById('file1').addEventListener('change', function(e) {
                handleFileUpload(e, 'file1');
            });
            
            // æ–‡ä»¶2ä¸Šä¼ 
            document.getElementById('file2').addEventListener('change', function(e) {
                handleFileUpload(e, 'file2');
            });
        }
        
        // åˆå§‹åŒ–æ‹–æ‹½ä¸Šä¼ 
        function initDragAndDrop() {
            const uploadBoxes = document.querySelectorAll('.upload-box');
            
            uploadBoxes.forEach((box, index) => {
                const fileId = index === 0 ? 'file1' : 'file2';
                
                box.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });
                
                box.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                });
                
                box.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    
                    if (e.dataTransfer.files.length) {
                        const file = e.dataTransfer.files[0];
                        const input = document.getElementById(fileId);
                        
                        // åˆ›å»ºDataTransferå¯¹è±¡æ¥è®¾ç½®æ–‡ä»¶
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        input.files = dataTransfer.files;
                        
                        // è§¦å‘changeäº‹ä»¶
                        const event = new Event('change', { bubbles: true });
                        input.dispatchEvent(event);
                    }
                });
            });
        }
        
        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        async function handleFileUpload(event, fileType) {
            const file = event.target.files[0];
            if (!file) return;
            
            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            const validExtensions = ['.xlsx', '.xls', '.csv'];
            const fileExt = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!validExtensions.includes(fileExt)) {
                showAlert('è¯·ä¸Šä¼ Excelæ–‡ä»¶(.xlsx, .xls)æˆ–CSVæ–‡ä»¶', 'error');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            showLoader(true);
            
            try {
                // è¯»å–æ–‡ä»¶
                const data = await readExcelFile(file);
                
                if (fileType === 'file1') {
                    file1Data = data;
                    updateFileInfo('file1-info', file, data.rows.length);
                } else {
                    file2Data = data;
                    updateFileInfo('file2-info', file, data.rows.length);
                }
                
                // æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
                document.getElementById('upload-help').style.display = 'flex';
                
                // æ˜¾ç¤ºé¢„è§ˆæŒ‰é’®
                if (file1Data && file2Data) {
                    document.getElementById('upload-buttons').style.display = 'block';
                    showAlert('ä¸¤ä¸ªæ–‡ä»¶éƒ½å·²ä¸Šä¼ ï¼Œå¯ä»¥å¼€å§‹é¢„è§ˆæ•°æ®', 'success');
                    
                    // åœ¨ç§»åŠ¨ç«¯æ˜¾ç¤ºåº•éƒ¨æ“ä½œæ 
                    if (window.innerWidth <= 768) {
                        document.getElementById('mobile-actions').style.display = 'flex';
                        document.getElementById('mobile-process-btn').disabled = false;
                    }
                }
            } catch (error) {
                showAlert('è¯»å–æ–‡ä»¶å¤±è´¥ï¼š' + error.message, 'error');
                console.error('è¯»å–æ–‡ä»¶å¤±è´¥:', error);
            } finally {
                showLoader(false);
            }
        }
        
        // è¯»å–Excelæ–‡ä»¶
        function readExcelFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const data = e.target.result;
                        const workbook = XLSX.read(data, { type: 'binary' });
                        
                        // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        
                        // è½¬æ¢ä¸ºJSONæ•°ç»„
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        
                        // å¤„ç†æ•°æ®
                        const headers = jsonData[0] || [];
                        const rows = jsonData.slice(1).filter(row => {
                            return row.some(cell => cell != null && cell !== '');
                        });
                        
                        resolve({
                            headers,
                            rows,
                            fileName: file.name,
                            fileSize: file.size,
                            sheetName
                        });
                    } catch (error) {
                        reject(error);
                    }
                };
                
                reader.onerror = function() {
                    reject(new Error('è¯»å–æ–‡ä»¶å¤±è´¥'));
                };
                
                reader.readAsBinaryString(file);
            });
        }
        
        // æ›´æ–°æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º
        function updateFileInfo(elementId, file, rowCount = 0) {
            const element = document.getElementById(elementId);
            const fileSize = (file.size / 1024).toFixed(1);
            
            element.innerHTML = `
                <div class="file-name">${file.name}</div>
                <div class="file-meta">
                    <span>${fileSize} KB</span>
                    <span>${rowCount} è¡Œæ•°æ®</span>
                </div>
            `;
        }
        
        // é¢„è§ˆæ•°æ®
        function previewData() {
            if (!file1Data || !file2Data) {
                showAlert('è¯·å…ˆä¸Šä¼ ä¸¤ä¸ªæ–‡ä»¶', 'error');
                return;
            }
            
            // æ˜¾ç¤ºé¢„è§ˆå¡ç‰‡
            document.getElementById('preview-card').style.display = 'block';
            
            // æ¸²æŸ“é¢„è§ˆè¡¨æ ¼
            renderPreviewTable('preview-table-1', file1Data);
            renderPreviewTable('preview-table-2', file2Data);
            
            // æ»šåŠ¨åˆ°é¢„è§ˆåŒºåŸŸ
            document.getElementById('preview-card').scrollIntoView({ behavior: 'smooth' });
            
            showAlert('æ•°æ®é¢„è§ˆå·²ç”Ÿæˆï¼Œè¯·æ£€æŸ¥æ•°æ®æ˜¯å¦æ­£ç¡®', 'info');
        }
        
        // æ¸²æŸ“é¢„è§ˆè¡¨æ ¼
        function renderPreviewTable(tableId, fileData) {
            const table = document.getElementById(tableId);
            table.innerHTML = '';
            
            const headers = fileData.headers;
            const rows = fileData.rows.slice(0, 10); // åªæ˜¾ç¤ºå‰10è¡Œ
            
            // åˆ›å»ºè¡¨å¤´
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header || `åˆ—${headers.indexOf(header) + 1}`;
                headerRow.appendChild(th);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // åˆ›å»ºè¡¨æ ¼ä¸»ä½“
            const tbody = document.createElement('tbody');
            
            if (rows.length === 0) {
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.colSpan = headers.length;
                cell.textContent = 'æ²¡æœ‰æ•°æ®';
                cell.style.textAlign = 'center';
                cell.style.padding = '40px';
                row.appendChild(cell);
                tbody.appendChild(row);
            } else {
                rows.forEach(rowData => {
                    const row = document.createElement('tr');
                    
                    headers.forEach((header, index) => {
                        const cell = document.createElement('td');
                        cell.textContent = rowData[index] !== undefined ? rowData[index] : '';
                        row.appendChild(cell);
                    });
                    
                    tbody.appendChild(row);
                });
            }
            
            table.appendChild(tbody);
        }
        
        // å¤„ç†æ•°æ®æ•´åˆ
        function processIntegration() {
            if (!file1Data || !file2Data) {
                showAlert('è¯·å…ˆä¸Šä¼ ä¸¤ä¸ªæ–‡ä»¶', 'error');
                return;
            }
            
            startTime = Date.now();
            showLoader(true);
            
            try {
                // æŸ¥æ‰¾ç”¨æˆ·åå’Œåºå·åˆ—
                const file1UsernameIndex = findColumnIndex(file1Data.headers, ['ç”¨æˆ·å', 'ç”¨æˆ·', 'åç§°', 'name', 'username']);
                const file1IdIndex = findColumnIndex(file1Data.headers, ['åºå·', 'ç¼–å·', 'ID', 'id', 'ç¼–å·']);
                
                const file2UsernameIndex = findColumnIndex(file2Data.headers, ['ç”¨æˆ·å', 'ç”¨æˆ·', 'åç§°', 'name', 'username']);
                
                if (file1UsernameIndex === -1) {
                    throw new Error('æ–‡ä»¶1ä¸­æœªæ‰¾åˆ°ç”¨æˆ·ååˆ—');
                }
                
                if (file2UsernameIndex === -1) {
                    throw new Error('æ–‡ä»¶2ä¸­æœªæ‰¾åˆ°ç”¨æˆ·ååˆ—');
                }
                
                // åˆ›å»ºç”¨æˆ·ååˆ°åºå·çš„æ˜ å°„
                const usernameToId = {};
                file1Data.rows.forEach(row => {
                    const username = String(row[file1UsernameIndex] || '').trim();
                    const id = file1IdIndex !== -1 ? (row[file1IdIndex] || '') : '';
                    
                    if (username && !usernameToId[username]) {
                        usernameToId[username] = id;
                    }
                });
                
                // å¤„ç†æ•°æ®æ•´åˆ
                const mergedData = [];
                const unmatchedData = [];
                let matchedCount = 0;
                let totalCount = 0;
                
                file2Data.rows.forEach(row => {
                    const username = String(row[file2UsernameIndex] || '').trim();
                    const id = usernameToId[username] || 'æœªåŒ¹é…';
                    
                    // åˆ›å»ºæ•´åˆåçš„è¡Œ
                    const mergedRow = {
                        'åºå·': id,
                        'ç”¨æˆ·å': username
                    };
                    
                    // æ·»åŠ æ–‡ä»¶2çš„å…¶ä»–æ•°æ®
                    file2Data.headers.forEach((header, index) => {
                        if (index !== file2UsernameIndex) {
                            mergedRow[header] = row[index] || '';
                        }
                    });
                    
                    mergedData.push(mergedRow);
                    totalCount++;
                    
                    if (id !== 'æœªåŒ¹é…') {
                        matchedCount++;
                    } else {
                        unmatchedData.push({
                            'ç”¨æˆ·å': username,
                            'åŸå› ': 'åœ¨æ–‡ä»¶1ä¸­æœªæ‰¾åˆ°åŒ¹é…çš„ç”¨æˆ·å'
                        });
                    }
                });
                
                // å­˜å‚¨æ•´åˆç»“æœ
                integrationResult = {
                    mergedData,
                    unmatchedData,
                    stats: {
                        total: totalCount,
                        matched: matchedCount,
                        unmatched: totalCount - matchedCount,
                        rate: totalCount > 0 ? ((matchedCount / totalCount) * 100).toFixed(1) : 0,
                        time: ((Date.now() - startTime) / 1000).toFixed(2)
                    }
                };
                
                // æ˜¾ç¤ºç»“æœ
                showResults();
                
                // å¯ç”¨ä¸‹è½½æŒ‰é’®
                document.getElementById('mobile-download-btn').disabled = false;
                
                showAlert(`æ•°æ®æ•´åˆå®Œæˆï¼æˆåŠŸåŒ¹é… ${matchedCount}/${totalCount} æ¡è®°å½•`, 'success');
            } catch (error) {
                showAlert('æ•´åˆæ•°æ®æ—¶å‡ºé”™ï¼š' + error.message, 'error');
                console.error('æ•´åˆæ•°æ®æ—¶å‡ºé”™:', error);
            } finally {
                showLoader(false);
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResults() {
            // æ˜¾ç¤ºç»“æœå¡ç‰‡
            document.getElementById('result-card').style.display = 'block';
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            document.getElementById('stat-total').textContent = integrationResult.stats.total;
            document.getElementById('stat-matched').textContent = integrationResult.stats.matched;
            document.getElementById('stat-rate').textContent = integrationResult.stats.rate + '%';
            document.getElementById('stat-time').textContent = integrationResult.stats.time + 's';
            
            // æ¸²æŸ“ç»“æœè¡¨æ ¼
            renderResultTable();
            
            // æ¸²æŸ“æœªåŒ¹é…è¡¨æ ¼
            renderUnmatchedTable();
            
            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            document.getElementById('result-card').scrollIntoView({ behavior: 'smooth' });
        }
        
        // æ¸²æŸ“ç»“æœè¡¨æ ¼
        function renderResultTable() {
            const table = document.getElementById('result-table');
            table.innerHTML = '';
            
            if (!integrationResult.mergedData.length) {
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.colSpan = 3;
                cell.textContent = 'æ²¡æœ‰æ•°æ®';
                cell.style.textAlign = 'center';
                cell.style.padding = '40px';
                row.appendChild(cell);
                table.appendChild(row);
                return;
            }
            
            // è·å–åˆ—å
            const firstRow = integrationResult.mergedData[0];
            const columns = Object.keys(firstRow);
            
            // åˆ›å»ºè¡¨å¤´
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            columns.forEach(column => {
                const th = document.createElement('th');
                th.textContent = column;
                headerRow.appendChild(th);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // åˆ›å»ºè¡¨æ ¼ä¸»ä½“
            const tbody = document.createElement('tbody');
            
            integrationResult.mergedData.slice(0, 50).forEach(rowData => { // åªæ˜¾ç¤ºå‰50è¡Œ
                const row = document.createElement('tr');
                
                // é«˜äº®æœªåŒ¹é…çš„è¡Œ
                if (rowData['åºå·'] === 'æœªåŒ¹é…') {
                    row.style.backgroundColor = '#fff5f5';
                }
                
                columns.forEach(column => {
                    const cell = document.createElement('td');
                    cell.textContent = rowData[column] !== undefined ? rowData[column] : '';
                    row.appendChild(cell);
                });
                
                tbody.appendChild(row);
            });
            
            table.appendChild(tbody);
            
            // å¦‚æœæ•°æ®è¶…è¿‡50è¡Œï¼Œæ˜¾ç¤ºæç¤º
            if (integrationResult.mergedData.length > 50) {
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.colSpan = columns.length;
                cell.textContent = `... è¿˜æœ‰ ${integrationResult.mergedData.length - 50} æ¡è®°å½•ï¼Œè¯·åœ¨ä¸‹è½½çš„æ–‡ä»¶ä¸­æŸ¥çœ‹å®Œæ•´æ•°æ®`;
                cell.style.textAlign = 'center';
                cell.style.fontStyle = 'italic';
                cell.style.color = 'var(--gray)';
                cell.style.padding = '16px';
                row.appendChild(cell);
                tbody.appendChild(row);
            }
        }
        
        // æ¸²æŸ“æœªåŒ¹é…è¡¨æ ¼
        function renderUnmatchedTable() {
            const table = document.getElementById('unmatched-table');
            table.innerHTML = '';
            
            if (!integrationResult.unmatchedData.length) {
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.colSpan = 2;
                cell.textContent = 'ğŸ‰ æ‰€æœ‰ç”¨æˆ·éƒ½åŒ¹é…æˆåŠŸï¼';
                cell.style.textAlign = 'center';
                cell.style.padding = '40px';
                cell.style.color = 'var(--success)';
                row.appendChild(cell);
                table.appendChild(row);
                return;
            }
            
            // åˆ›å»ºè¡¨å¤´
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            ['ç”¨æˆ·å', 'åŸå› '].forEach(column => {
                const th = document.createElement('th');
                th.textContent = column;
                headerRow.appendChild(th);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // åˆ›å»ºè¡¨æ ¼ä¸»ä½“
            const tbody = document.createElement('tbody');
            
            integrationResult.unmatchedData.forEach(rowData => {
                const row = document.createElement('tr');
                
                ['ç”¨æˆ·å', 'åŸå› '].forEach(column => {
                    const cell = document.createElement('td');
                    cell.textContent = rowData[column] || '';
                    row.appendChild(cell);
                });
                
                tbody.appendChild(row);
            });
            
            table.appendChild(tbody);
        }
        
        // ä¸‹è½½ç»“æœ
        function downloadResult() {
            if (!integrationResult || !integrationResult.mergedData.length) {
                showAlert('æ²¡æœ‰å¯ä¸‹è½½çš„æ•°æ®', 'error');
                return;
            }
            
            try {
                // åˆ›å»ºå·¥ä½œè¡¨
                const ws = XLSX.utils.json_to_sheet(integrationResult.mergedData);
                
                // åˆ›å»ºå·¥ä½œç°¿
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "æ•´åˆç»“æœ");
                
                // å¦‚æœæœ‰æ²¡æœ‰åŒ¹é…çš„æ•°æ®ï¼Œæ·»åŠ åˆ°ç¬¬äºŒä¸ªå·¥ä½œè¡¨
                if (integrationResult.unmatchedData.length > 0) {
                    const ws2 = XLSX.utils.json_to_sheet(integrationResult.unmatchedData);
                    XLSX.utils.book_append_sheet(wb, ws2, "æœªåŒ¹é…æ•°æ®");
                }
                
                // ç”Ÿæˆæ–‡ä»¶å
                const timestamp = new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-');
                const fileName = `æ•°æ®æ•´åˆç»“æœ_${timestamp}.xlsx`;
                
                // ä¸‹è½½æ–‡ä»¶
                XLSX.writeFile(wb, fileName);
                
                showAlert('æ–‡ä»¶ä¸‹è½½å¼€å§‹ï¼Œè¯·æŸ¥çœ‹æµè§ˆå™¨ä¸‹è½½åˆ—è¡¨', 'success', 3000);
            } catch (error) {
                showAlert('ä¸‹è½½å¤±è´¥ï¼š' + error.message, 'error');
                console.error('ä¸‹è½½å¤±è´¥:', error);
            }
        }
        
        // é‡ç½®åº”ç”¨
        function resetApp() {
            if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹å—ï¼Ÿå½“å‰æ•°æ®å°†ä¼šä¸¢å¤±ã€‚')) {
                // é‡ç½®æ•°æ®
                file1Data = null;
                file2Data = null;
                integrationResult = null;
                
                // é‡ç½®æ–‡ä»¶è¾“å…¥
                document.getElementById('file1').value = '';
                document.getElementById('file2').value = '';
                
                // é‡ç½®æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º
                document.getElementById('file1-info').innerHTML = `
                    <div class="file-name">ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½æ–‡ä»¶</div>
                    <div class="file-meta">
                        <span>æ”¯æŒ: .xlsx, .xls, .csv</span>
                        <span>å¤§å°: æ— é™åˆ¶</span>
                    </div>
                `;
                
                document.getElementById('file2-info').innerHTML = `
                    <div class="file-name">ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½æ–‡ä»¶</div>
                    <div class="file-meta">
                        <span>æ”¯æŒ: .xlsx, .xls, .csv</span>
                        <span>å¤§å°: æ— é™åˆ¶</span>
                    </div>
                `;
                
                // éšè—å¡ç‰‡
                document.getElementById('upload-help').style.display = 'none';
                document.getElementById('upload-buttons').style.display = 'none';
                document.getElementById('preview-card').style.display = 'none';
                document.getElementById('result-card').style.display = 'none';
                document.getElementById('mobile-actions').style.display = 'none';
                
                // æ»šåŠ¨åˆ°é¡¶éƒ¨
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                showAlert('å·²é‡ç½®ï¼Œå¯ä»¥é‡æ–°ä¸Šä¼ æ–‡ä»¶', 'info');
            }
        }
        
        // æŸ¥æ‰¾åˆ—ç´¢å¼•
        function findColumnIndex(headers, possibleNames) {
            for (let name of possibleNames) {
                const index = headers.findIndex(header => 
                    header && String(header).toLowerCase().includes(name.toLowerCase())
                );
                if (index !== -1) return index;
            }
            return -1;
        }
        
        // åˆå§‹åŒ–æ ‡ç­¾é¡µ
        function initTabs() {
            document.querySelectorAll('.tabs').forEach(tabContainer => {
                const tabs = tabContainer.querySelectorAll('.tab');
                const tabContents = tabContainer.parentElement.querySelectorAll('.tab-content');
                
                tabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const tabId = this.getAttribute('data-tab');
                        
                        // ç§»é™¤æ‰€æœ‰activeç±»
                        tabs.forEach(t => t.classList.remove('active'));
                        tabContents.forEach(c => c.classList.remove('active'));
                        
                        // æ·»åŠ activeç±»
                        this.classList.add('active');
                        document.getElementById(tabId).classList.add('active');
                    });
                });
            });
        }
        
        // æ˜¾ç¤º/éšè—åŠ è½½åŠ¨ç”»
        function showLoader(show) {
            document.getElementById('upload-loader').style.display = show ? 'block' : 'none';
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯æç¤º
        function showAlert(message, type, duration = 3000) {
            // åˆ›å»ºæç¤ºå…ƒç´ 
            const alertEl = document.createElement('div');
            alertEl.className = `alert alert-${type}`;
            alertEl.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                 type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <div>${message}</div>
            `;
            
            // æ·»åŠ åˆ°é¡µé¢é¡¶éƒ¨
            const container = document.querySelector('.container');
            container.insertBefore(alertEl, container.firstChild);
            
            // è‡ªåŠ¨ç§»é™¤
            if (duration > 0) {
                setTimeout(() => {
                    alertEl.style.opacity = '0';
                    alertEl.style.transform = 'translateY(-10px)';
                    setTimeout(() => alertEl.remove(), 300);
                }, duration);
            }
        }
        
        // PWAç›¸å…³åŠŸèƒ½
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            // é˜»æ­¢æµè§ˆå™¨é»˜è®¤çš„å®‰è£…æç¤º
            e.preventDefault();
            // ä¿å­˜äº‹ä»¶ä»¥ä¾¿åç»­è§¦å‘
            deferredPrompt = e;
            // æ˜¾ç¤ºè‡ªå®šä¹‰å®‰è£…æç¤º
            setTimeout(() => {
                document.getElementById('install-prompt').style.display = 'block';
            }, 5000);
        });
        
        function checkPWAInstall() {
            // æ£€æŸ¥æ˜¯å¦å·²å®‰è£…
            if (window.matchMedia('(display-mode: standalone)').matches || 
                window.navigator.standalone === true) {
                console.log('å·²å®‰è£…ä¸ºPWA');
            }
        }
        
        function installApp() {
            if (deferredPrompt) {
                // æ˜¾ç¤ºå®‰è£…æç¤º
                deferredPrompt.prompt();
                // ç­‰å¾…ç”¨æˆ·å“åº”
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('ç”¨æˆ·æ¥å—äº†å®‰è£…');
                    } else {
                        console.log('ç”¨æˆ·æ‹’ç»äº†å®‰è£…');
                    }
                    deferredPrompt = null;
                });
            }
            hideInstallPrompt();
        }
        
        function hideInstallPrompt() {
            document.getElementById('install-prompt').style.display = 'none';
        }
        
        // æ·»åŠ åˆ°ä¸»å±å¹•æç¤º
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(err => {
                    console.log('ServiceWorkeræ³¨å†Œå¤±è´¥:', err);
                });
            });
        }
        
        // å¯¼å‡ºå‡½æ•°ä¾›å…¨å±€ä½¿ç”¨
        window.previewData = previewData;
        window.processIntegration = processIntegration;
        window.downloadResult = downloadResult;
        window.resetApp = resetApp;
        window.installApp = installApp;
        window.hideInstallPrompt = hideInstallPrompt;
    </script>
</body>
</html>